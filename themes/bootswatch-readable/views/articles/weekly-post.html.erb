<div id="fb-root"></div>

<%= javascript_tag do %>
    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0';
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
<% end %>

<% @articleLink = link_to_permalink(@article, @article.title) %>

<% link = Nokogiri::HTML(@articleLink) %>
<% atag = link.xpath('//a/@href') %>
<% final_link = atag.map {|attr| attr.value} %>

<div class="article" id="article-<%= @article.id %>">
    <h2 class='page-header p-name entry-title'>
        <%= @articleLink %>
    </h2>
    <div class='article-meta e-content entry-content article'>
        <%= render 'articles/meta', article: @article %>
    </div>
    <div class='article e-content entry-content'>
        <%= render 'articles/protected_article_content', { article: @article } %>
    </div>
    <!-- -->

    <div class="article entry-share-div"
         style="border: 1px solid #eee;padding: 20px;text-align: center;margin-top: 10px;box-shadow: 0px 2px 3px -1px #aaa;">
        <div class="article-meta e-content entry-content article"
             style="float: left;width: 100%;margin-bottom: -10px;font-style: italic;">
            Share on Facebook
        </div>
        <div class="fb-share-button"
             data-href="<%= final_link[0] %>"
             data-layout="button_count" data-size="large" data-mobile-iframe="true">
            <a target="_blank"
               href="https://www.facebook.com/sharer/sharer.php?u=<%#= u @articleLink %>&amp;src=sdkpreparse"
               class="fb-xfbml-parse-ignore">Share on Facebook</a>
        </div>
    </div>
    <!-- -->
</div>